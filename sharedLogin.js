(window.webpackJsonpUnataWidgets=window.webpackJsonpUnataWidgets||[]).push([[41],{"6980d6b279871fb7b0ff":function(n,i,e){"use strict";e.r(i);var s=e("46f8f4ccfe1b73ca4d0c"),a=e.n(s),o=e("aeff03d7704771d2e696"),l=e("fc9c4e3a879f16727654");i.default=a.a.module("sharedLoginComponentModule",[]).component("sharedLogin",{bindings:{errorMessage:"=?",displayResetPasswordLink:"<",passwordResetFn:"&",closeModal:"&",context:"<"},controller:["$scope","$rootScope","$location","$sce","$state","$stateParams","auth","config","lang","recaptchaService","redirectService","socialSignOnService","userAnalytics",function(n,i,e,s,a,r,t,c,d,g,p,u,m){var h,b,v;if(this.lang=d,this.singleSignOnEnabled=null===(h=c.singleSignOn)||void 0===h?void 0:h.enabled,this.socialSignOnEnabled=null===(b=c.socialSignOn)||void 0===b?void 0:b.enabled,this.ssoActionLabel=null===(v=c.socialSignOn)||void 0===v?void 0:v.actionLabel,this.loginCredentials={username:null,password:null},this.recaptcha={enabled:g.isEnabled(),token:null,action:l.a.LOGIN,onSuccess:i=>{n.$apply(()=>{this.recaptcha.token=i})},onExpired:()=>{n.$apply(()=>{this.recaptcha.token=null})}},this.singleSignOnEnabled){const n=`${e.protocol()}://${e.host()}${e.path()}`;this.redirectTo=`${c.singleSignOn.idpSsoEndpoint}?rp=${c.singleSignOn.relayPartnerId}&relayState=${n}`,this.sloEndpoint=s.trustAsResourceUrl(c.singleSignOn.sloEndpoint),this.recaptcha.enabled=!1}else this.loginSubmit=()=>{var n;this.loginCredentials.username?this.loginCredentials.password?!this.recaptcha.enabled||this.recaptcha.token?(delete this.errorMessage,this.isLoggingIn=!0,t.login(this.loginCredentials.username,this.loginCredentials.password,null,this.context,this.recaptcha.enabled?{token:this.recaptcha.token,siteKey:null===(n=c.googleRecaptcha)||void 0===n?void 0:n.siteKey}:null).then(()=>{this.context===o.a.LOYALTY_ONBOARDING?m.logUserLoginAttempt({success:!0,loyalty_onboarding:!0,improved_registration:c.enableImprovedRegistration}):m.logUserLoginAttempt({success:!0,improved_registration:c.enableImprovedRegistration}),this.closeModal(),i.isAppLoading=!1,"main.socialSignOn"===a.current.name?p.goToRedirectUrl({href:r&&r.redirect},{state:"main.home"}):"main.home"===a.current.name&&p.loadRedirectUrl()}).catch(n=>{this.context===o.a.LOYALTY_ONBOARDING?m.logUserLoginAttempt({success:!1,loyalty_onboarding:!0,improved_registration:c.enableImprovedRegistration}):m.logUserLoginAttempt({success:!1,improved_registration:c.enableImprovedRegistration}),this.errorMessage=n,document.getElementById("login-email").focus(),this.recaptcha.token=null,g.resetLastCheckbox()}).finally(()=>{this.isLoggingIn=!1})):this.errorMessage=this.lang.values.recaptchaError:document.getElementById("login-password").focus():document.getElementById("login-email").focus()};this.socialSignOnEnabled&&(this.socialSignOnProviders=c.socialSignOn.providers,this.socialSignOnGetURL=n=>{this.errorMessage="",u.handleSocialSignOn(n).then(()=>{this.context===o.a.LOYALTY_ONBOARDING&&m.logUserLoyaltyOnboardingSocialSignOn({success:!0,provider_id:n.id})}).catch(i=>{this.context===o.a.LOYALTY_ONBOARDING&&m.logUserLoyaltyOnboardingSocialSignOn({success:!1,provider_id:n.id}),this.errorMessage=i.data&&i.data.message||i,document.getElementById("login-email").focus()})})}],template:'\n      <div class="login" ng-class="{ \'social-enabled\': $ctrl.socialSignOnEnabled }" data-test="shared-login">\n\n        <form ng-if=":: $ctrl.singleSignOnEnabled" action="{{$ctrl.sloEndpoint}}" method="post" id="login-form" focus-first-input>\n          <shared-login-form-contents\n            error-message="$ctrl.errorMessage"\n            is-logging-in="$ctrl.isLoggingIn"\n            login-credentials="$ctrl.loginCredentials"\n            submit-login-form="$ctrl.loginSubmit"\n            recaptcha="$ctrl.recaptcha"\n            social-disabled-action="$ctrl.passwordResetFn()"\n          >\n          </shared-login-form-contents>\n\n          <input type="hidden" name="redirectTo" value="{{$ctrl.redirectTo}}">\n        </form>\n\n        <form ng-if=":: !$ctrl.singleSignOnEnabled" ng-submit="$ctrl.loginSubmit(); analytics.logEvent(\'login\', \'submit\')" id="login-form" ng-class="::{\'full-width\': !$ctrl.socialSignOnEnabled}" focus-first-input>\n          <shared-login-form-contents\n            error-message="$ctrl.errorMessage"\n            is-logging-in="$ctrl.isLoggingIn"\n            login-credentials="$ctrl.loginCredentials"\n            submit-login-form="$ctrl.loginSubmit"\n            recaptcha="$ctrl.recaptcha"\n            social-disabled-action="$ctrl.passwordResetFn()"\n          >\n          </shared-login-form-contents>\n        </form>\n\n        <forgot-password-button ng-if=":: $ctrl.displayResetPasswordLink" set-view-fn="$ctrl.passwordResetFn()"></forgot-password-button>\n\n        <div class="login-divider" ng-if=":: $ctrl.socialSignOnEnabled">\n          <span class="login-divider-text">{{:: $ctrl.lang.values.or}}</span>\n        </div>\n\n        <div class="social-login" ng-if=":: $ctrl.socialSignOnEnabled">\n          <div class="form-row" ng-repeat="provider in ::$ctrl.socialSignOnProviders track by provider.id">\n            <button\n              type="button"\n              id="login-social-provider-{{:: provider.id}}"\n              class="{{:: provider.id}} button"\n              ng-click="$ctrl.socialSignOnGetURL(provider.id)">\n                <span ng-if="::provider.fullLabel">{{::provider.fullLabel}}</span>\n                <span ng-if="::!provider.fullLabel">{{::$ctrl.ssoActionLabel}} {{::provider.label}}</span>\n            </button>\n          </div>\n        </div>\n\n      </div>\n    '}).component("sharedLoginFormContents",{bindings:{errorMessage:"<",isLoggingIn:"<",loginCredentials:"=",submitLoginForm:"&",recaptcha:"<",socialDisabledAction:"&"},require:{form:"^"},controller:["config","lang",function(n,i){var e,s,a,o;this.lang=i,this.showSocialDisabledText=null===(e=n.socialSignOn)||void 0===e?void 0:e.showDisabledText,this.showSocialDisabledAction=null===(s=n.socialSignOn)||void 0===s?void 0:s.showDisabledAction,this.socialDisabledText=null===(a=n.socialSignOn)||void 0===a?void 0:a.disabledText,this.socialDisabledActionText=null===(o=n.socialSignOn)||void 0===o?void 0:o.disabledActionText}],template:'\n      <div class="shared-login-form-contents">\n        <div class="regular-login">\n          <p class="required-fields-message">{{::$ctrl.lang.values.requiredFieldsMessage}}</p>\n          <div class="form-row">\n            <label for="login-email">{{::$ctrl.lang.values.email}}</label>\n            <div class="icon-left">\n              <span class="icon-left icon-email" aria-hidden="true"></span>\n              <input name="username" ng-model="$ctrl.loginCredentials.username" type="email" class="input" auto-focus="true" required placeholder="Email" id="login-email" aria-label="{{::$ctrl.lang.aria.email}}" aria-describedby="login-email-error">\n              <span class="validation-icon" aria-hidden="true"></span>\n              <span id="login-email-error" class="required-field" ng-if="$ctrl.form.username.$touched && $ctrl.form.username.$invalid">{{::$ctrl.lang.values.requiredForm.email}}</span>\n            </div>\n          </div>\n          <div class="form-row regular-login-password-row">\n            <label for="login-password">{{::$ctrl.lang.values.password}}</label>\n            <div class="icon-left">\n              <span class="icon-left icon-key" aria-hidden="true"></span>\n              <input name="password" ng-model="$ctrl.loginCredentials.password" type="password" class="input" required placeholder="Password" id="login-password" aria-label="{{::$ctrl.lang.aria.password}}" aria-describedby="login-password-error">\n              <span class="validation-icon" aria-hidden="true"></span>\n              <span id="login-password-error" class="required-field" ng-if="$ctrl.form.password.$touched && $ctrl.form.password.$invalid">{{::$ctrl.lang.values.requiredForm.password}}</span>\n            </div>\n          </div>\n          <div ng-if="::$ctrl.recaptcha.enabled" class="form-row recaptcha-row">\n            <recaptcha-checkbox\n              action="$ctrl.recaptcha.action"\n              on-success="$ctrl.recaptcha.onSuccess"\n              on-expired="$ctrl.recaptcha.onExpired"\n            />\n          </div>\n          <div class="form-row">\n            <button type="submit" form="login-form" class="button mobile-bottom" ng-disabled="$ctrl.isLoggingIn" ng-class="{loading: $ctrl.isLoggingIn}" id="login-submit">{{::$ctrl.lang.values.signIn}}</button>\n          </div>\n          <div id="social-disabled-message" class="form-row social-disabled-message icon-info-i" ng-if="$ctrl.showSocialDisabledText">{{::$ctrl.socialDisabledText}} <button id="social-disabled-action" type="button" ng-if="$ctrl.showSocialDisabledAction" ng-click="$ctrl.socialDisabledAction()">{{::$ctrl.socialDisabledActionText}}</button></div>\n        </div>\n      </div>\n\n      <div ng-if="$ctrl.errorMessage" class="message error reveal form-row">\n        <span class="icon-error" aria-hidden="true"></span>\n        {{$ctrl.errorMessage}}\n      </div>\n    '})}}]);