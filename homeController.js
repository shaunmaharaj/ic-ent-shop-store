(window.webpackJsonpUnataWidgets=window.webpackJsonpUnataWidgets||[]).push([[19],{"5267bb6367ba0e71ee4c":function(e,t,o){"use strict";o.r(t);var n=o("98f11010eed1f30a67e8"),a=o.n(n),i=o("5ad5fa305fb9d8886d1b"),r=o.n(i),l=o("3dde4251a4e36fb3d2d7"),s=o.n(l),c=o("3e908ad0180dad25b23e"),d=o.n(c),u=o("46f8f4ccfe1b73ca4d0c"),g=o.n(u),b=o("dc8a8022fbc5f3c4f01e"),v=o("eb6af1c2df260e74a1d2"),h=o("e1f00ec641bfbc36c166"),m=o("a94fc052e46176e6a566"),p=o("aeff03d7704771d2e696"),C=o("2befd5a067fda4f72081"),y=o("45cec0a70e71322cebfa"),f=o("905419495f8be31ee12a"),P=o("50f183ce0d50cfbf39da"),I=o("2bbacca12332faf89dc1"),O=o("8e6be6e05a65da6e40a7"),L=o("b4f24dc1f4c4321311a7");function w(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function S(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?w(Object(o),!0).forEach((function(t){k(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):w(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function k(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}t.default=g.a.module("HomeControllerModule",[]).controller("HomeController",["$filter","$q","$rootScope","$scope","$state","$stateParams","$window","Restangular","analytics","auth","canvas","cartService","catalogCategoriesService","collectionsService","config","lang","loyaltyInfoService","loyaltyOnboardingService","mobileService","oneCartService","orderService","placementsService","policyService","registrationService","reservationService","shoppingSelectorService","tagsService","userService","utilService",function(e,t,o,n,i,l,c,u,w,k,T,A,_,F,j,D,E,H,M,x,R,q,B,$,U,N,V,Q,W){var K,Y,J,X;n.reservationService=U,n.auth=k,n.canvas=T,n.categories=[],n.config=j,n.shoppingSelectorService=N,n.tags=V.quickshopTags,n.utilService=W,n.imageTransform=C.f,n.cartCountItems=A.countItems,n.buyItAgainCollection=void 0,n.showBuyItAgain=!1,n.homepageFeaturedProductsCollection=void 0,n.showHomepageFeaturedProducts=!1,n.showWaysToShop=Object(O.a)("waysToShop",null===(K=k.user.store)||void 0===K||null===(Y=K.store_banner)||void 0===Y?void 0:Y.key),n.buyItAgainText="buy it again carousel",n.homepageFeaturedProductsText="featured products carousel",n.hasBannerImage=Object(L.e)(),n.showHeroContent=!0,n.showBannerContent=!0,n.reactQuickLinkEnabled=j.react.enableQuickLinks||Object(v.a)(),_.fetchCategories().then(()=>{n.categories=_.visibleRootCategories()}),q.getHeroContent(M.isMobile).then(e=>{var t;n.heroContent=e,n.showHeroContent=!(null===(t=n.heroContent)||void 0===t||!t.length)});const z=q.getBannerContent().then(e=>{var t;n.bannerContent=e,n.showBannerContent=!(null===(t=n.bannerContent)||void 0===t||!t.length)});let G;n.bannerTarget=e=>{var t;return"new_tab"===(null==e||null===(t=e.target)||void 0===t?void 0:t.openIn)?"_blank":void 0},n.logPromotedPlacement=(e,t,o)=>q.logPromotedPlacement(e,t,o),n.urlPassedCollectionIds=q.getURLPassedCollectionsList(l);const Z=(null===(J=j.allowPassingCollectionIDAsQueryParams)||void 0===J?void 0:J.homepage)&&(null===(X=n.urlPassedCollectionIds)||void 0===X?void 0:X.length)>0;function ee(){f.b.emit(f.a.OPEN_LOYALTY_CONTEXT)}G=Z?F.getCollectionsFromSet(n.urlPassedCollectionIds).then(e=>{var t,o;j.buyItAgain.enabled&&(e=e.filter(e=>"1"!==e.id)),n.collectionPlacements=e,n.collections=null!==(t=null===(o=e)||void 0===o?void 0:o.map(e=>S({},e)))&&void 0!==t?t:[]}):q.getHomePageCollections().then(e=>{var t,o;j.buyItAgain.enabled&&(e=e.filter(e=>{var t,o;return"1"!==(null===(t=e.target)||void 0===t||null===(o=t.collection)||void 0===o?void 0:o.id)})),n.collectionPlacements=e,n.collections=null!==(t=null===(o=e)||void 0===o?void 0:o.map(e=>S({},e)))&&void 0!==t?t:[]}),n.getCollectionData=(e,t)=>{var o;Z||F.getCollection(null===(o=e.target)||void 0===o?void 0:o.collection.id,m.a.PRODUCT_LIMIT).then(e=>{g.a.copy(e,n.collections[t])})},M.isMobile&&(n.maxBannerCollectionLengthArray=[],t.all([G,z]).then(()=>{n.maxBannerCollectionLengthArray=new Array(Math.max(n.collections.length,n.bannerContent.length))})),u.all("orders").getList({limit:3,one_cart_enabled:x.enabled(),user_timezone:Intl.DateTimeFormat().resolvedOptions().timeZone}).then(e=>{n.orders=e}),n.loginToOrders=function(){$.open("login",null,null,null,null,null,p.a.VIEW_ORDER_HISTORY).then(()=>{var e;(null===(e=k.user)||void 0===e?void 0:e.status)!==I.a.TRIAL&&i.go("main.account.orderHistory")})},n.handleViewOrderClick=e=>R.handleViewOrderClick(e),n.quickLinks=d()(s()(j.quickLinks,(e,t)=>{const o=r()({},e,{id:t});return"loyalty"===t&&j.hasLoyaltyPoints&&Q.getLoyaltyCards().then(()=>{const e=Q.getPrimaryLoyaltyCard();e&&(o.iconText=`${e.points_balance||0} Points`)}),o}),"order"),"instore"===k.user.context.intent?n.quickLinksFiltered=a()(n.quickLinks,e=>e.context.list):n.quickLinksFiltered=a()(n.quickLinks,e=>e.context.cart),n.quickLinkClick=function(e){if("loyalty"===e.id)ee();else if(e.href)c.open(e.href,"_blank");else if(e.state&&e.stateParams)i.go(e.state,e.stateParams);else if(e.state)i.go(e.state);else if(e.dotComLinkPath){const t=j.dotComModule.url+e.dotComLinkPath;M.isMobileApp()?c.open(t,"_blank"):c.location=t}},f.b.on(f.a.QUICK_LINK_CLICK,n.quickLinkClick),n.loyaltyPoints=Q.getLoyaltyCard().points_balance,n.onItemClick=(e,t)=>{"loyalty"===t.event?ee():"openSideCart"===t.event&&o.$broadcast("sideCart","open")},n.timeslotLabelFn=()=>y.utils.getMainLabel(n.reservationService.displayReservation,{verboseLevel:1,returnLabel:!1,format:U.reservation?j.apiDateFormat:h.a});const te=({bustCache:e})=>{var t;null!==(t=j.buyItAgain)&&void 0!==t&&t.enabled&&F.getCollection(m.a.BIA_COLLECTION_ID,m.a.PRODUCT_LIMIT,e).then(e=>{if(!(e&&Array.isArray(e.items)))return n.showBuyItAgain=!1,void Object(b.b)("invalid buyItAgain collection data returned, not rendering it");n.buyItAgainCollection=e,n.buyItAgainCollection.name=j.buyItAgain.displayName,n.buyItAgainCollection.items.forEach(e=>{e.store_product.tags=e.store_product.tags.filter(e=>"purchased"!==e)}),n.showBuyItAgain=!!n.buyItAgainCollection.items&&n.buyItAgainCollection.items.length>5})},oe=({bustCache:e})=>{var t;null!==(t=j.homepageFeaturedProducts)&&void 0!==t&&t.enabled&&F.getCollection(m.a.HOMEPAGE_FP_COLLECTION_ID,m.a.PRODUCT_LIMIT,e).then(e=>{if(!(e&&Array.isArray(e.items)))return n.showHomepageFeaturedProducts=!1,void Object(b.b)("invalid homepageFeaturedProducts collection data returned, not rendering it");n.homepageFeaturedProductsCollection=e,n.homepageFeaturedProductsCollection.name=j.homepageFeaturedProducts.displayName,n.showHomepageFeaturedProducts=!!n.homepageFeaturedProductsCollection.items&&n.homepageFeaturedProductsCollection.items.length>=j.homepageFeaturedProducts.displayThreshold})};te({bustCache:!1}),oe({bustCache:!1}),o.$on("auth",(e,t)=>{t===P.a.CONTEXT_UPDATED&&(te({bustCache:!0}),oe({bustCache:!0}))}),n.logHomepageView=()=>{n.canvas.logPageView("homeview"),w.logSegmentEvent("store.homepage_view",Object(L.b)())},n.openPolicyModal=()=>{B.open("pricing")},n.isIntentChangeDisabled=o.modifyingInstacartOrder,n.intent=k.getContext().intent||j.defaultShoppingContext,n.intentIcon=()=>"instore"===n.intent?"list":n.intent,n.intentLabel=()=>{var e;return"instore"===n.intent?(null===(e=D.values.shoppingContextAltTitles)||void 0===e?void 0:e.instore)||j.shoppingSelector.instore.title:j.shoppingSelector[n.intent].title},n.onIntentChange=()=>N.open("confirmation"),n.intentLocation=()=>C.b.selectors.getContextLocationString(),n.shouldShowIntentTimeslot=()=>"instore"===n.intent?!!k.user.store.store_hours:!(j.policyModal.showPricingPolicyInHeader&&j.policyModal.isPricingPolicyEnabled||j.hideTimeslotReservationFromTrialUsers&&"trial"===k.user.status),n.intentTimeslotLabel=()=>"instore"===n.intent?D.values.todaysHours:U.previewTimeslot?D.values.timeslotAvailable:D.values.yourTimeslot,n.intentTimeslotDetails=()=>"instore"===n.intent?e("todaysHours")(k.user.store.store_hours):n.timeslotLabelFn()}])}}]);