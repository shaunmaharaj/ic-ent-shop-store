(window.webpackJsonpUnataWidgets=window.webpackJsonpUnataWidgets||[]).push([[38],{"323046ecaa1a4d6f1b2c":function(e,t,a){var r=a("f2ef6f6e544aad97aa22");e.exports=function(){if(!arguments.length)return[];var e=arguments[0];return r(e)?e:[e]}},b0b9a71b2632fd0ebe2d:function(e,t,a){"use strict";a.r(t);var r=a("e2c7e6633c04cafaa8ce"),s=a.n(r),n=a("323046ecaa1a4d6f1b2c"),l=a.n(n),o=a("98f11010eed1f30a67e8"),c=a.n(o),i=a("3e908ad0180dad25b23e"),d=a.n(i),u=a("3dde4251a4e36fb3d2d7"),g=a.n(u),m=a("272e516c7ea07952d3f5"),p=a.n(m),h=a("79f02df8bccb8ad95613"),f=a.n(h),_=a("f2ef6f6e544aad97aa22"),b=a.n(_),y=a("6a55381db84a511b309a"),v=a.n(y),S=a("691be5ce6eef2724d26f"),C=a.n(S),F=a("46f8f4ccfe1b73ca4d0c"),P=a.n(F),I=a("c808d8f3b62a083fb08b"),w=a("9d9254d5da639caa8d5c");const O=["Brands","purchased","organic","gluten_free","fat_free","vegan","kosher","sugar_free","on_sale","has_offer","loyalty_deal","usa_snap_eligible"],R="REFORMULATION",T="SPELL_CORRECTION";var A=a("44944295d8d5c3cf61db");const j=(e,t)=>Object(A.singular)(e.toLowerCase())!==Object(A.singular)(t.toLowerCase());function N(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function x(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?N(Object(a),!0).forEach((function(t){$(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):N(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function $(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}t.default=P.a.module("SearchControllerModule",[]).controller("SearchController",["$filter","$scope","$state","$stateParams","Restangular","analytics","auth","cartAnalytics","catalogCategoriesService","config","eComLightService","facetedFilterModalService","facetedSearchService","fetchedRootCategories","filterModalService","lang","mobileService","placementsService","productsService","searchCategories","searchService","tagsService","utilService",function(e,t,a,r,n,o,i,u,m,h,_,y,S,F,A,N,$,D,E,M,L,k,B){if(r.sort||(r.sort=h.defaultSort["trial"===i.user.status?"trial":"loggedIn"].search,a.params.sort=r.sort),t.enableFacetedSearchFilters=h.enableFacetedSearchFilters||h.enableICSearch,t.enableDotComSearch=L.isDotComEnabled(),t.categories=[],t.config=h,t.filterTags=k.filterDynamicTags(k.filterBarTags),h.enableICSearch&&(t.filterTags=t.filterTags.filter(e=>O.includes(e.id))),t.showPickupContextSwitch=!1,t.showDeliveryContextSwitch=!1,t.showCateringContextSwitch=!1,t.hideFacets=!0,t.enableFacetedSearchFilters){t.facets=[];const e=C()(F,e=>e.id),a=x(x({},r),{},{search_provider:h.enableICSearch?"ic":"buffet"});S.getAllFacets(a).then(a=>{t.facets=a,t.categoryFacets=S.categorizedFacetsObject.categories,t.sideFacetsArray=S.categorizedFacetsObject.sideFilters,h.enableICSearch&&(t.sideFacetsArray=t.sideFacetsArray.map(e=>O.includes(e.group_display_name)?e:x(x({},e),{},{items:e.items.filter(e=>O.includes(e.name))})).filter(e=>e.items.length)),t.hideFacets=a.hideFacets||0===t.sideFacetsArray.length,t.categoryFacets&&t.categoryFacets.items&&t.categoryFacets.items.length&&(t.rootCategoryFacets=t.categoryFacets.items.filter(t=>e.includes(t.id.toString()))),t.$broadcast("facetsDataReceived",t.facets)}).catch(()=>{t.hideFacets=!0})}if(t.tagsService=k,t.state=a,t.stateParams=r,t.term=r.search_term,t.brandNames=[],t.inEComLightMode=_.inEComLightMode,t.analyticScope=u.createNewAnalyticScope(),t.$on("$destroy",()=>{u.destroyAnalyticScope(t.analyticScope)}),t.categoryId=P.a.isDefined(r.category_id)?r.category_id:null,t.searchCategories=M,t.categoryNameFromId=e=>{const t=m.categoryFromId(e.toString());return t&&t.name||""},t.facetCountFromID=function(e){if(!t.categoryFacets)return;const a=v()(t.categoryFacets.items,t=>{if(t.id==e)return!0});return a?a.item_count:0},t.$on("$stateChangeStart",()=>{t.loading=!0,delete t.results,t.hasPrimaryResults=!1,t.hasSecondaryResults=!1}),t.tags=b()(a.params.tags)?a.params.tags:[a.params.tags],a.params.brand_name||a.params.brand_names){const e=a.params.brand_name||a.params.brand_names;t.brands=Array.isArray(e)?e:[e]}function U(e){return{name:e,value:e}}t.filterCategory=function(e){a.go(".",{category_id:e,page:null,brand_name:null})},t.page={current:a.params.page||1},t.$watch("page.current",(e,t)=>{t&&e!==t&&a.go(".",{page:e})}),t.hideSideNav=!1,t.loadResults=()=>{t.loadingResults=!0;const e=P.a.copy(a.params),s=L.getSnrid();e.page=null,e.offset=t.page.current?(t.page.current-1)*h.productsPerPage:0,e.limit=h.productsPerPage,e.search_provider=h.enableICSearch?"ic":"buffet",e.secondary_results=h.enableICSearch,e.allow_autocorrect="false"!==r.allow_autocorrect,n.all("store_products").getList(e,{"X-Snr-Id":s}).then(e=>{var r,n,l,c,i,d,u,g,m,p;null===(r=document.getElementById(a.params.toggledFilterId))||void 0===r||r.focus(),a.params.toggledFilterId=null,t.loadingResults=!1,t.results=e,t.primary_results=t.results,t.secondary_results=[],t.initialSearchTerm=t.results.initial_search_term;const f=Object(w.c)(e),_=o.getProductListAnalytics([...f,...e],{slim:!0});o.logPlacementImpression(e.placements.filter(e=>"none"===e.item_type).map(e=>Object(w.a)(e,"search_placement")),"search","search_placement"),null!==(n=h.elevaate)&&void 0!==n&&n.enabled&&null!==(l=h.elevaate)&&void 0!==l&&l.tag&&(window.elevaatePromotions=window.elevaatePromotions||[],f.forEach(t=>{var a,r;"elevaate"===t.sponsoredBy&&window.elevaatePromotions.push({agreementId:t.metadata.agreementId,pageImpressionId:null==e||null===(a=e.adProviderMetadata)||void 0===a||null===(r=a.elevaate)||void 0===r?void 0:r.pageImpressionId,dssId:t.metadata.dssId,productId:t.metadata.productId,productIdInFeed:t.metadata.productIdInFeed,productPrice:t.metadata.price,currencyCode:h.elevaateCurrencyCode,pageProductId:null==t?void 0:t.id})})),(null===(c=t.results)||void 0===c||null===(i=c.placements)||void 0===i?void 0:i.length)>0&&(t.results=Object(w.b)(t.results.placements,t.results)),h.enableICSearch&&(t.primary_results=t.results.filter(e=>L.isPrimaryResult(e)),t.secondary_results=t.results.filter(e=>!L.isPrimaryResult(e))),t.hasPrimaryResults=(null===(d=t.primary_results)||void 0===d?void 0:d.length)+(null===(u=t.results.placements)||void 0===u?void 0:u.length)>0,t.hasSecondaryResults=(null===(g=t.secondary_results)||void 0===g?void 0:g.length)>0,o.logEvent("search results","search",t.term,_.length),o.logSegmentEvent("search.search_results",{search_value:t.term,snrid:s,search_results_count:_.length,search_results:_,search_results_page:t.page.current,is_autocomplete:t.stateParams.search_is_autocomplete||!1,sort:t.stateParams.sort,total_results:e.item_count,expected_pages:Math.round(e.item_count/h.productsPerPage)+1,filters:B.filterParams(t.categoryNameFromId,t.stateParams),search_provider:e.search_provider||"buffet",num_primary_results:null===(m=t.primary_results)||void 0===m?void 0:m.length,num_secondary_results:null===(p=t.secondary_results)||void 0===p?void 0:p.length}),o.logSearch({results:e.map(e=>String(e.ext_id)),term:t.term}),o.logCriteoStoreProducts({items:e.map(e=>String(e.ext_id)),keyword:t.term,page_number:t.page.current,filterParams:B.filterParams(t.categoryNameFromId,t.stateParams)}),e.available_context_types&&(t.showPickupContextSwitch=e.available_context_types.includes(I.c.PICKUP),t.showDeliveryContextSwitch=e.available_context_types.includes(I.c.DELIVERY),t.showCateringContextSwitch=e.available_context_types.includes(I.c.CATERING))}).finally(()=>{var e;E.getBeacon(null===(e=t.results)||void 0===e?void 0:e.onLoadBeacon)})},t.enableFacetedSearchFilters||function(){let e=null;P.a.isDefined(a.params.category_id)&&(e=v()(t.searchCategories,e=>e.category.id===a.params.category_id)),t.brandNames=e?e.brand_names:f()(p()(g()(t.searchCategories,"brand_names"))).sort()}(),t.handleImagePlacementClick=(e,t)=>D.handleImagePlacementClick(Object(w.a)(e,"search_placement"),"search",t),t.getPageHeaderResults=()=>t.getSearchResultsText(),t.getSearchReformulationText=()=>{if(!t.results)return null;const{primary_search_term:e,initial_search_term:a,recall_strategies_applied:r}=t.results;return e&&e!=a&&null!=r&&r.includes(R)&&j(e,a)?N.templateAsString(N.values.nothingFound,{searchResult:a}):null},t.isSpellCorrected=()=>{if(!t.results)return!1;const{primary_search_term:e,initial_search_term:a,recall_strategies_applied:r}=t.results;return e&&e!=a&&(null==r?void 0:r.includes(T))&&j(e,a)},t.getSearchSpellCorrectionDisabledSref=()=>{if(!t.isSpellCorrected())return null;const{initial_search_term:e}=t.results;return JSON.stringify({allow_autocorrect:!1,search_term:e})},t.getSearchResultsText=()=>{var a;let s;const n=null===(a=t.results)||void 0===a?void 0:a.primary_search_term;if(s=n&&j(n,r.search_term)?n:r.search_term,!t.results)return N.templateAsString(N.values.searchingFor,{searchTerm:s});const l=Array.isArray(r.tags)?r.tags.map(e=>t.getTagName(e)).join(", "):t.getTagName(r.tags),o=` ${r.tags?`and "${l}"`:""} ${r.brand_name?`and "${r.brand_name}"`:""} ${t.categoryId?` in ${t.categoryNameFromId(t.categoryId)}`:""}`;s=t.enableFacetedSearchFilters?($.isMobile,s):$.isMobile?s:s+o;const c=(r.tags||r.brand_name||r.brand_names)&&$.isMobile?",":"",i=(t.results&&t.results.placements?t.results.placements.length:0)+(t.results&&t.results.item_count?t.results.item_count:0);if(t.hasPrimaryResults){var d,u;const a=(N.templateAsString(N.values.resultsForTerm,{count:(null===(d=t.secondary_results)||void 0===d?void 0:d.length)>0?"":i,label:e("pluralize")("result",i),searchTerm:s})+c).trim();return(null===(u=t.secondary_results)||void 0===u?void 0:u.length)>0?a.charAt(0).toUpperCase()+a.slice(1):a}return N.templateAsString(N.values.nothingFound,{searchResult:s})+c};const z=({content:e,sort:t,tags:r,brand_name:s})=>{const n=L.getTypeBy(e);n&&("Products"===n.label?a.go(n.state,{sort:t,tags:r,brand_name:s}):a.go(n.state))};t.openFilterModal=function(){A.open({content:"Products",sortOptions:d()(c()(h.sortOptions),"order"),subset:"search",tagOptions:t.filterTags,brandOptions:g()(t.brandNames,U),sort:a.params.sort,tags:l()(a.params.tags||[]),brand:a.params.brand_name,defaultSort:h.defaultSort["trial"===i.user.status?"trial":"loggedIn"].shop,defaultBrand:null,isSearch:!0}).then(z)},t.openFacetedFilterModal=function(){y.open({content:"Products",sortOptions:d()(c()(h.sortOptions,e=>s()(e.showIn,"search")),"order"),tagOptions:t.filterTags,brandOptions:g()(t.brandNames,U),facetOptions:t.facetedTags,facets:t.facets,sort:a.params.sort,tags:l()(a.params.tags||[]),brand:a.params.brand_name,defaultSort:h.defaultSort["trial"===i.user.status?"trial":"loggedIn"].shop,searchTerm:null,isSearch:!0,showSort:!0}).then(z)},t.resetFacets=()=>{S.resetTagCrumbs(),a.go(".",{page:null,brand_name:null,brand_names:null,tags:null,category_id:null})},t.shouldShowSeeAll=()=>S.tagCrumbsArray.length>0||r.category_id,t.shouldShowReset=()=>S.tagCrumbsArray.length>0,t.getTagName=e=>S.getTagName(e)}])}}]);