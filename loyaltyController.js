(window.webpackJsonpUnataWidgets=window.webpackJsonpUnataWidgets||[]).push([[23],{"42facfc459c8a1781276":function(t,e){t.exports='<div class=loyalty-wrapper fixed-to-body ng-controller=LoyaltyController> <p ng-if=":: lang.values.loyaltySubHeader" ng-bind-html=":: lang.values.loyaltySubHeader"></p> <div ng-if=updating> <div class=view-loading-indicator></div> </div> <div ng-if=promoCodeService.successMessage class="message success" scroll-into-view> <span class=icon-checkmark-circle aria-hidden=true></span> {{promoCodeService.successMessage}} <button class=button-link ng-click=promoCodeService.clearSuccessMessage()>{{::lang.values.dismiss}}</button> </div> <div class=content-section ng-if="!updating && !config.disableLoyaltyCard"> <h2 ng-if=cards.length class=section-divider-small> <span class=title>{{::lang.values.loyaltyCard}}{{hasMultipleLoyaltyCards ? \'s\' : \'\'}}</span> </h2> <p ng-if=::lang.values.loyaltyCardInfo ng-bind-html=::lang.values.loyaltyCardInfo /> <div loyalty-card ng-if=primaryCard card=primaryCard loyalty-pass=loyaltyPass use-barcode-number-label=isBusinessUser></div> <div ng-if=cards.length class="form-wrapper cards-list"> <div ng-if=":: !config.hasMultipleLoyaltyCards && config.loyalty.enableLoyaltyNumberEditing"> <form class=form-add-card ng-submit=updateCards()> <label class=required-overwrite for=loyalty-edit-field>{{::lang.aria.enter + \' \' + lang.aria.loyaltyCard}}</label> <input id=loyalty-edit-field type=text required class="input small" ng-model=cards[0].card_number pattern={{::config.loyaltyCardPattern}} data-test=loyalty-edit-field> <button class="button action small" data-test=loyalty-edit-submit>{{::lang.values.save}}</button> </form> </div> <table class=table ng-if=":: config.hasMultipleLoyaltyCards"> <thead> <tr> <td>{{::lang.values.loyaltyCardType}}</td> <td id=loyalty-program-id>{{::lang.values.loyaltyCard + \' \' + lang.values.loyaltyCardId}}</td> </tr> </thead> <tbody> <tr ng-repeat="card in cards"> <td> <span ng-if=card.primary_card>{{::lang.values.primary}}</span> <span ng-if=!card.primary_card>{{::lang.values.linked}}</span> </td> <td> <span ng-if=card.primary_card> <form class=button-inline ng-submit=updateCards()> <input id=unata-loyalty-edit-field type=text required class="input small" ng-model=card.card_number pattern={{::config.loyaltyCardPattern}} maxlength={{::config.loyaltyCardMaxLength}} data-test=loyalty-edit-field aria-labelledby=loyalty-program-id> <button id=unata-loyalty-edit-submit class="button action small" data-test=loyalty-edit-submit>{{::lang.values.save}}</button> </form> </span> <span ng-if=!card.primary_card>{{card.card_number}}</span> </td> </tr> </tbody> </table> </div> </div> <div ng-if="!updating && config.enableContinuityOffers" class="content-section continuity-offers"> <div class=section-divider-small> <div class=title> {{ ::config.continuityOffers.title }} </div> <span> <button id=unata-loyalty-rewards-filter-all type=button class="button small hollow" ng-click="filterContinuityOffers(\'all\')">All ({{continuityOffers.length}})</button> <button id=unata-loyalty-rewards-filter-complete type=button class="button small hollow" ng-click="filterContinuityOffers(\'complete\')">Completed ({{completedContinuityOffers.length}})</button> <button id=unata-loyalty-rewards-filter-inprogress type=button class="button small hollow" ng-click="filterContinuityOffers(\'inProgress\')">In Progress ({{inProgressContinuityOffers.length}})</button> <button id=unata-loyalty-rewards-filter-inactive type=button class="button small hollow" ng-click="filterContinuityOffers(\'inactive\')">Not Started ({{inactiveContinuityOffers.length}})</button> </span> </div> <div class=continuity-offer-cell-container> <div class=continuity-offer-cell ng-repeat="offer in filteredContinuityOffersSet | limitTo: numberOfContinuityOffersToShow"> <span continuity-offer-cell offer=offer></span> </div> <div class=no-continuity-offers ng-if=!filteredContinuityOffersSet.length> {{ ::config.continuityOffers.noOffers }} </div> </div> <div ng-if="filteredContinuityOffersSet.length > numberOfContinuityOffersToShow" class=continuity-show-more-toggle> <button type=button name=button class="button small hollow" ng-click=showMoreContinuityOffers()>{{ ::config.lang.showMore }}</button> </div> </div> <div class="content-section card-add" ng-if=!updating> <div ng-if="!config.loyalty.disableAddCard && (config.hasMultipleLoyaltyCards || !primaryCard) && !config.disableLoyaltyCard"> <h2 class=section-divider-small> <span class=title>{{primaryCard ? lang.values.linkAdditional : lang.values.link}} {{::lang.values.loyaltyCard}} :</span> </h2> <form class="form-add-card form" ng-submit=addCard()> <label class=required-overwrite for=unata-loyalty-add-card-field>{{::lang.aria.enter + \' \' + lang.aria.loyaltyCard}}</label> <input required id=unata-loyalty-add-card-field class="input small" type=text ng-model=newCard.card_number pattern={{::config.loyaltyCardPattern}} maxlength={{::config.loyaltyCardMaxLength}} placeholder="Enter {{::lang.values.loyaltyCardPlaceholder || lang.values.loyaltyCard}}" data-test=loyalty-add-card-field> <button id=unata-loyalty-add-card-submit class="button small" data-test=loyalty-add-card-submit>{{primaryCard ? lang.values.link : lang.values.add}} Card</button> <button ng-if="config.showAssignCardButton  && !primaryCard" class="button hollow small">{{::lang.values.beAssignedDigitalCard}}</button> </form> </div> </div> <div ng-if="!config.disableLoyaltyTransactionHistory && !updating" class="content-section card-transaction-history"> <react-loyalty-transactions/> </div> <div class=content-footer> <div ng-if=error class="message error loyalty-indent" scroll-into-view scrollcontainer=.loyalty-wrapper targetelement=.content-footer data-test=loyalty-error-message> <span class=icon-error aria-hidden=true></span> {{error}} </div> <div ng-if=message class="message success loyalty-indent" scroll-into-view scrollcontainer=.loyalty-wrapper targetelement=.content-footer data-test=loyalty-success-message>{{message}}</div> </div> </div> '},"472d0bf4487dc0071caf":function(t,e){t.exports='<div class=loyalty-wrapper trap-focus ng-class="{\'loyalty-wrapper-mobile\': isMobile}" fixed-to-body ng-controller=LoyaltyController> <div ng-if=updating> <div class=view-loading-indicator></div> </div> <div class=card-container role=dialog aria-modal=true aria-label={{::lang.values.loyaltyCard}} ng-if="!hideMobileCard && primaryCard"> <div class=content-section ng-if=!updating> <button class=modal-close ng-click=util.goBack() aria-label={{::lang.aria.modalClose}}></button> <h1 class=screenreadertext>{{::lang.values.loyaltyCard}}</h1> <div loyalty-card ng-if=primaryCard card=primaryCard loyalty-pass=loyaltyPass use-barcode-number-label=isBusinessUser></div> <div class=loyalty-bottom-button-container> <button ng-if="!updating && config.enableContinuityOffers" ng-click=showContinuityOffersSection() class=loyalty-bottom-button> <span>{{::lang.template(lang.values.myRewards)}}</span> </button> <button ng-click=showManageCardsSection() ng-if=config.loyalty.enableLoyaltyNumberEditing class=loyalty-bottom-button data-test=manage-loyalty-button> <span>{{::lang.template(lang.values.manageRewards, {loyaltyCardName: lang.values.loyaltyCard})}}</span> </button> <button ng-click=showTransHistorySection() ng-if=!config.disableLoyaltyTransactionHistory class=loyalty-bottom-button> <span>{{::lang.template(lang.values.transactionHistory)}}</span> </button> </div> </div> </div> <div class=non-card-container ng-if="!hideManageCards || !primaryCard" role=dialog aria-modal=true aria-label="{{::lang.template(lang.values.manageRewards, {loyaltyCardName: lang.values.loyaltyCard})}}"> <div class=loyalty-mobile-bottom-header> <button class=icon-delete ng-click=hideManageCardsSection() aria-label={{::lang.aria.hideSection}}></button> </div> <h1 class=screenreadertext>{{::lang.template(lang.values.manageRewards, {loyaltyCardName: lang.values.loyaltyCard})}}</h1> <div ng-if=":: lang.values.loyaltySubHeader" ng-bind-html=":: lang.values.loyaltySubHeader" class=card-add></div> <div class=non-card-content-wrapper> <div class="content-section card-add" ng-if=!updating> <div ng-if="!config.loyalty.disableAddCard && (config.hasMultipleLoyaltyCards || !primaryCard)"> <h2 class=section-divider-small> <span class=title>{{primaryCard ? lang.values.linkAdditional : lang.values.link}} {{::lang.values.loyaltyCard}} :</span> </h2> <form class="form button-inline" ng-submit=addCard()> <label class=required-overwrite for=loyaltyAddCard>{{::lang.aria.enter + \' \' + lang.aria.loyaltyCard}}</label> <input id=loyaltyAddCard required class="input small" type=text ng-model=newCard.card_number aria-label="{{::lang.aria.enter + \' \' + lang.aria.loyaltyCard}}" placeholder="{{::lang.aria.enter + \' \' + lang.aria.loyaltyCard}}" data-test=loyalty-add-card-field> <button data-test=loyalty-add-card-submit class="button small">{{primaryCard ? lang.values.link : lang.values.add}} Card</button> <button ng-if="config.showAssignCardButton  && !primaryCard" class="button hollow small">{{::lang.values.beAssignedDigitalCard}}</button> </form> </div> </div> <div class=content-section ng-if=!updating> <div ng-if="config.loyalty.enableLoyaltyNumberEditing && cards.length" class="form-wrapper cards-list"> <div ng-if=!config.hasMultipleLoyaltyCards> <form class=button-inline ng-submit=updateCards()> <label for=editLoyaltyCard>Enter Card Number</label> <input id=editLoyaltyCard type=text required class="input small" ng-model=cards[0].card_number pattern={{::config.loyaltyCardPattern}} aria-label="Enter Card Number" data-test=loyalty-edit-field> <button data-test=loyalty-edit-submit class="button action small">{{::lang.values.save}}</button> </form> </div> <table class=table ng-if=config.hasMultipleLoyaltyCards> <thead> <tr> <td>{{::lang.values.loyaltyCardType}}</td> <td id=loyalty-program-id>{{::lang.values.loyaltyCard + \' \' + lang.values.loyaltyCardId}}</td> </tr> </thead> <tbody> <tr ng-repeat="card in cards"> <td> <span ng-if=card.primary_card>{{::lang.values.primary}}</span> <span ng-if=!card.primary_card>{{::lang.values.linked}}</span> </td> <td> <span ng-if=card.primary_card> <form class=button-inline ng-submit=updateCards()> <input id=editLoyaltyCard type=text required class="input small" ng-model=card.card_number pattern={{::config.loyaltyCardPattern}} aria-label="Enter Card Number" data-test=loyalty-edit-field aria-labelledby=loyalty-program-id> <button class="button action small" data-test=loyalty-edit-submit>{{::lang.values.save}}</button> </form> </span> <span ng-if=!card.primary_card>{{card.card_number}}</span> </td> </tr> </tbody> </table> </div> <div ng-if=error class="message error loyalty-indent" scroll-into-view data-test=loyalty-error-message> <span class=icon-error aria-hidden=true></span> {{error}} </div> <div ng-if=message class="message success loyalty-indent" scroll-into-view data-test=loyalty-success-message> <span class=icon-checkmark-circle aria-hidden=true></span> {{message}} </div> </div> </div> </div> <div class=non-card-container ng-if="!hideContinuityOffers && config.enableContinuityOffers"> <div class=loyalty-mobile-bottom-header> <button class=icon-chevron-left ng-click=hideContinuityOffersSection() aria-label={{::lang.aria.hideSection}}></button> <span class=title>{{::lang.template(lang.values.myRewards)}}</span> </div> <div ng-if=::lang.values.loyaltySubHeader ng-bind-html=::lang.values.loyaltySubHeader class=card-add></div> <div ng-if=!updating class="menu js-mobile-shop-menu"> <ui class=continuty-offers-menu-wrapper> <li role=button class=item ng-repeat="(key, value) in continuityOffersMenu" ng-class="{current: key === selectedContinuityOffersMenuItem}" ng-click=filterContinuityOffers(key)>{{value}}</li>  </ui> </div> <div class="content-section continuity-wrapper" ng-if=!updating> <div class="content-section continuity-offers"> <div class=continuity-offer-cell-container> <div class=continuity-offer-cell ng-repeat="offer in filteredContinuityOffersSet | limitTo: numberOfContinuityOffersToShow"> <span continuity-offer-cell offer=offer></span> </div> <div class=no-continuity-offers ng-if=!filteredContinuityOffersSet.length> {{ ::config.continuityOffers.noOffers }} </div> </div> <div ng-if="filteredContinuityOffersSet.length > numberOfContinuityOffersToShow" class=continuity-show-more-toggle> <button type=button name=button class="button small hollow" ng-click=showMoreContinuityOffers()>{{ ::config.lang.showMore }}</button> </div> </div> </div> </div> <div class=non-card-container ng-if="!hideTransHistory && !config.disableLoyaltyTransactionHistory"> <div class=loyalty-mobile-bottom-header> <button class=icon-chevron-left ng-click=hideTransHistorySection() aria-label={{::lang.aria.hideSection}}></button> <span class=title>{{::lang.template(lang.values.transactionHistory)}}</span> </div> <div class="content-section card-transaction-history"> <react-loyalty-transactions/> </div> </div> </div> '},"58ef523db3b983b3907b":function(t,e){t.exports=' <div ng-controller=LoyaltyController> <div ng-if=promoCodeService.successMessage class=loyalty-messages-container> <div class="message success" scroll-into-view> <span class=icon-checkmark-circle aria-hidden=true></span> {{ promoCodeService.successMessage }} <button class=button-link ng-click=promoCodeService.clearSuccessMessage()>{{::lang.values.dismiss}}</button> </div> </div> <div ng-if="!updating && config.enableContinuityOffers" class="content-section continuity-offers"> <div ng-if=::!mobile.isMobile class=section-divider-small> <div class=title> {{ ::config.continuityOffers.title }} </div> <span> <button type=button class="button small hollow" ng-click="filterContinuityOffers(\'all\')">All ({{continuityOffers.length}})</button> <button type=button class="button small hollow" ng-click="filterContinuityOffers(\'complete\')">Completed ({{completedContinuityOffers.length}})</button> <button type=button class="button small hollow" ng-click="filterContinuityOffers(\'inProgress\')">In Progress ({{inProgressContinuityOffers.length}})</button> <button type=button class="button small hollow" ng-click="filterContinuityOffers(\'inactive\')">Not Started ({{inactiveContinuityOffers.length}})</button> </span> </div> <div class=continuity-offer-cell-container> <div class=continuity-offer-cell ng-repeat="offer in filteredContinuityOffersSet | limitTo: numberOfContinuityOffersToShow"> <span continuity-offer-cell offer=offer></span> </div> <div class=no-continuity-offers ng-if=!filteredContinuityOffersSet.length> {{ ::config.continuityOffers.noOffers }} </div> </div> <div ng-if="filteredContinuityOffersSet.length > numberOfContinuityOffersToShow" class=continuity-show-more-toggle> <button type=button name=button class="button small hollow" ng-click=showMoreContinuityOffers()>{{ ::config.lang.showMore }}</button> </div> </div> </div> '},c637ec4b37ab33d47c7d:function(t,e,a){"use strict";a.r(e);var n=a("559d028df5b5cd24757e"),i=a.n(n),l=a("98f11010eed1f30a67e8"),s=a.n(l),o=a("46f8f4ccfe1b73ca4d0c"),r=a.n(o);e.default=r.a.module("LoyaltyControllerModule",[]).controller("LoyaltyController",["$element","$q","$scope","$state","$stateParams","$timeout","auth","config","lang","mobileService","nativeMobileBrightnessService","offersService","promoCodeService","registrationService","userAnalytics","userService","utilService",function(t,e,a,n,l,o,d,c,u,y,f,g,m,b,p,v,C){a.user=d.user,a.updating=!0,a.promoCodeService=m,a.continuityOffers=[],a.filteredContinuityOffersSet=[],a.completedContinuityOffers=[],a.inProgressContinuityOffers=[],a.inactiveContinuityOffers=[],a.selectedContinuityOffersMenuItem="all",a.continuityOffersMenu={},a.isMobile=y.isMobile,a.newCard={},y.isMobileApp()&&!c.disableLoyaltyCard&&(f.enableFullBrightnessMode(),a.$on("$destroy",()=>{f.resetBrightnessMode()})),g.fetchContinuityOffers().then(t=>{const e=t||[];a.continuityOffers=e,a.filteredContinuityOffersSet=e,a.completedContinuityOffers=s()(e,t=>t.continuity.rwd_activated),a.inProgressContinuityOffers=s()(e,t=>t.continuity.offer_activated&&!t.continuity.rwd_activated),a.inactiveContinuityOffers=s()(e,t=>!t.continuity.offer_activated),a.continuityOffersMenu={all:u.template(u.values.continuityOffersMenu.all,{offersLength:a.continuityOffers.length}),complete:u.template(u.values.continuityOffersMenu.complete,{offersLength:a.completedContinuityOffers.length}),inProgress:u.template(u.values.continuityOffersMenu.inProgress,{offersLength:a.inProgressContinuityOffers.length}),inactive:u.template(u.values.continuityOffersMenu.inactive,{offersLength:a.inactiveContinuityOffers.length})},a.updating=!1}),a.filterContinuityOffers=t=>{a.selectedContinuityOffersMenuItem=t,"all"===t?a.filteredContinuityOffersSet=a.continuityOffers:"complete"===t?a.filteredContinuityOffersSet=a.completedContinuityOffers:"inProgress"===t?a.filteredContinuityOffersSet=a.inProgressContinuityOffers:"inactive"===t&&(a.filteredContinuityOffersSet=a.inactiveContinuityOffers)},a.numberOfContinuityOffersToShow=c.continuityOffers.numberOfOffersToShow,a.showMoreContinuityOffers=()=>{a.numberOfContinuityOffersToShow=a.continuityOffers.length},y.isMobile&&(a.hideManageCards=!0,a.hideTransHistory=!0,a.hideContinuityOffers=!0,a.hideMobileCard=!1,o(()=>{var e;null===(e=t[0].querySelector(".modal-close"))||void 0===e||e.focus()},0)),a.render=function(){return e.all([v.getLoyaltyCards(),v.getLoyaltyPasses()]).then(()=>{var t,e,n;(a.cards=r.a.copy(v.loyaltyCards),a.primaryCard=r.a.copy(v.getPrimaryLoyaltyCard()),a.linkedCards=v.getNonPrimaryLoyaltyCard(),a.loyaltyPass=(null===(t=v.loyaltyPasses)||void 0===t?void 0:t[0])||null,a.isBusinessUser=Boolean(null===(e=a.user.ext_data)||void 0===e?void 0:e.IS_BUSINESS),a.isBusinessUser)&&(a.primaryCard.barcode_number=null===(n=a.user.ext_data)||void 0===n?void 0:n.CARD_NUMBER)})},a.addCard=function(){const t=i()(a.cards),e={card_number:a.newCard.card_number};t&&t.length||(e.primary_card=!0),t.push(e),a.updating=!0,a.message=null,a.error=null,v.updateLoyaltyCards(t).then(()=>{p.logUserLinkLoyaltyCard(),a.render(),a.updating=!1,a.message=u.values.loyaltyCardAddedSuccess},t=>{a.updating=!1,a.error=t.data?t.data.message:t.message})},a.updateCards=function(){a.updating=!0,a.message=null,a.error=null,v.updateLoyaltyCards(a.cards).then(()=>{a.render(),a.updating=!1,a.message=u.values.loyaltyCardUpdateSuccess},t=>{40304===t.error?b.promptLogin("main.account.loyalty","","","",u.values.loginToContinue):(a.error=t.data?t.data.message:t.message,a.updating=!1)})},a.showManageCardsSection=function(){y.isMobileApp()&&f.pauseFullBrightnessMode(),a.hideManageCards=!1,a.hideMobileCard=!0,a.hideTransHistory=!0,a.hideContinuityOffers=!0,o(()=>{t[0].querySelector(".icon-delete").focus()},0)},a.hideManageCardsSection=function(){y.isMobileApp()&&f.resumeFullBrightnessMode(),a.error=null,a.message=null,void 0!==a.primaryCard?(a.hideMobileCard=!1,a.hideManageCards=!0,a.hideTransHistory=!0,a.hideContinuityOffers=!0,o(()=>{t[0].querySelector(".loyalty-bottom-button").focus()},0)):C.goBack()},a.showContinuityOffersSection=function(){y.isMobileApp()&&f.pauseFullBrightnessMode(),a.hideContinuityOffers=!1,a.hideMobileCard=!0,a.hideManageCards=!0,a.hideTransHistory=!0,o(()=>{const e=t[0].querySelector(".js-mobile-shop-menu");if(e){const t=e.querySelector(".current"),a=window.innerWidth>0?window.innerWidth:screen.width;t&&(e.scrollLeft=t.offsetLeft-(a-t.offsetWidth)/2)}},0)},a.hideContinuityOffersSection=function(){y.isMobileApp()&&f.resumeFullBrightnessMode(),a.error=null,a.message=null,void 0!==a.primaryCard?(a.hideMobileCard=!1,a.hideContinuityOffers=!0,a.hideManageCards=!0,a.hideTransHistory=!0):C.goBack()},a.showTransHistorySection=function(){y.isMobileApp()&&f.pauseFullBrightnessMode(),a.hideTransHistory=!1,a.hideMobileCard=!0,a.hideManageCards=!0,a.hideContinuityOffers=!0},a.hideTransHistorySection=function(){y.isMobileApp()&&f.resumeFullBrightnessMode(),a.error=null,a.message=null,a.hideMobileCard=!1,a.hideManageCards=!0,a.hideTransHistory=!0,a.hideContinuityOffers=!0},l.enterPromoCode&&C.openPromoCodeModal(),a.render(),v.fetchLoyaltyCards().then(()=>a.render())}]).run(["$templateCache",t=>{t.put("loyalty.desktop.html",a("42facfc459c8a1781276")),t.put("loyalty.mobile.html",a("472d0bf4487dc0071caf")),t.put("loyalty.mobileAlternate.html",a("58ef523db3b983b3907b"))}])}}]);