{"version":3,"sources":["webpack://UnataWidgets/./app/angular/components/shop/controllers/shopMenuController.js"],"names":["angular","module","controller","$element","$location","$q","$rootScope","$scope","$state","$stateParams","$timeout","$window","config","eComLightService","facetedSearchService","mobileService","tagsService","tree","utilService","state","hideFacets","showSiblings","siblings","sibling","stateIs","params","current","children","length","idAttrs","generateIdAttr","treeNode","appendCategoryIdToIdAttr","currentIdAttr","replace","category_id","recipe_category_id","parents","enableFacetedSearchFilters","enableICSearch","getAllFacets","then","results","sideFacetsArray","categorizedFacetsObject","sideFilters","filter","sideFilter","items","useFacetedFilters","$broadcast","catch","isMobile","shopMenuEl","querySelector","currentMenuItemEl","screenWidth","window","innerWidth","screen","width","scrollLeft","offsetLeft","offsetWidth","navigateToUrl","url","go","match","path","isLinkInternal","openInternalUrl","open","sref","event","preventDefault","stopPropagation","addClass","resetFacets","resetTagCrumbs","page","brand_name","tags","shouldShowReset","tagCrumbsArray","isNonEComLightChild","treeChild","eComLight","enabled","isNonEComLightCategory"],"mappings":"gQAGeA,cACZC,OAAO,oCAAqC,IAC5CC,WACC,qBAHW,sMAIX,SACEC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,GAEAX,EAAOK,OAASA,EAChBL,EAAOY,MAAQX,EACfD,EAAOU,KAAOA,EAEdV,EAAOW,YAAcA,EAGrBX,EAAOa,YAAa,EAgBpBb,EAAOc,aAVa,IAAOJ,EAAKK,SAAUC,GAC/BL,EAAYM,QACjBD,EAAQJ,MACRI,EAAQE,OACRR,EAAKS,QAAQP,MACbF,EAAKS,QAAQD,YAGKlB,EAAOU,KAAKU,WAAapB,EAAOU,KAAKU,SAASC,QAMtErB,EAAOsB,QAAU,GAEjB,MAIMC,EAAiBC,IACrBC,OALgCC,EAKN,eAAcF,EAASZ,MAAMe,QAAQ,IAAK,QALrBT,EAK6BM,EAASN,UAJ1EA,EAAOU,aAAeV,EAAOW,oBACnC,GAAEH,KAAiBR,EAAOU,aAAeV,EAAOW,qBACjDH,EAH2B,IAACA,EAAeR,GAO7CR,EAAKoB,UACP9B,EAAOsB,QAAQQ,QAAU,IAAMpB,EAAKoB,QAASP,IAE3CvB,EAAOc,eACTd,EAAOsB,QAAQP,SAAW,IAAML,EAAKK,SAAUQ,IAE7Cb,EAAKU,UAAYV,EAAKU,SAASC,OAAS,GAC1CrB,EAAOsB,QAAQH,QAAUI,EAAeb,EAAKS,SAC7CnB,EAAOsB,QAAQF,SAAW,IAAMV,EAAKU,SAAUG,IACrCvB,EAAOc,eAEjBd,EAAOsB,QAAQH,QAAUI,EAAeb,EAAKS,WAI3Cd,EAAO0B,4BAA8B1B,EAAO2B,iBAC9CzB,EACG0B,aAAa/B,GACbgC,KAAKC,IAAW,MACfnC,EAAOoC,gBAAP,UAAyB7B,EAAqB8B,+BAA9C,aAAyB,EAA8CC,YAAYC,OACjFC,GAAcA,EAAWC,MAAMpB,OAAS,GAE1CrB,EAAOa,WACLsB,EAAQtB,aACPJ,EAAYiC,qBACqB,IAAlC1C,EAAOoC,gBAAgBf,OACzBtB,EAAW4C,WAAW,qBAAsBR,KAE7CS,MAAM,KACL5C,EAAOa,YAAa,IAKtBL,EAAcqC,UAAY7C,EAAOc,cACnCX,EAAS,KAEP,MAAM2C,EAAalD,EAAS,GAAGmD,cAAc,wBAC7C,GAAID,EAAY,CACd,MAAME,EAAoBF,EAAWC,cAAc,YAE7CE,EAAcC,OAAOC,WAAa,EAAID,OAAOC,WAAaC,OAAOC,MAEnEL,IAEFF,EAAWQ,WACTN,EAAkBO,YAAcN,EAAcD,EAAkBQ,aAAe,KAGpF,GAQLxD,EAAOyD,cAAgBC,IAEV,KAAPA,EAEFzD,EAAO0D,GAAG,aACDD,EAAIE,MAAM,OAEnB/D,EAAUgE,KAAKH,GACN/C,EAAYmD,eAAeJ,GACpC/C,EAAYoD,gBAAgBL,GAG5BtD,EAAQ4D,KAAKN,EAAK,UAItB1D,EAAO2D,GAAK,SAAUM,EAAM/C,EAAQgD,GAElCA,WAAOC,iBAEPD,WAAOE,kBACFzD,EAAYM,QAAQgD,EAAM/C,IAC7BtB,EAASyE,SAAS,SAEpBpE,EAAO0D,GAAGM,EAAM/C,IAGlBlB,EAAOsE,YAAc,KACnB/D,EAAqBgE,iBACrBtE,EAAO0D,GAAG,IAAK,CAAEa,KAAM,KAAMC,WAAY,KAAMC,KAAM,QAGvD1E,EAAO2E,gBAAkB,IAChBpE,EAAqBqE,eAAevD,OAAS,EAGtDrB,EAAO6E,oBAAsBC,IACpBzE,EAAO0E,UAAUC,UAAU1E,aAA3B,EAA2BA,EAAkB2E,uBAAuBH","file":"shopMenuController.js","sourcesContent":["import _ from 'lodash'\nimport angular from 'angular'\n\nexport default angular\n  .module('ShopMenuControllerComponentModule', [])\n  .controller(\n    'ShopMenuController',\n    function (\n      $element,\n      $location,\n      $q,\n      $rootScope,\n      $scope,\n      $state,\n      $stateParams,\n      $timeout,\n      $window,\n      config,\n      eComLightService,\n      facetedSearchService,\n      mobileService,\n      tagsService,\n      tree,\n      utilService\n    ) {\n      $scope.config = config\n      $scope.state = $state\n      $scope.tree = tree\n\n      $scope.utilService = utilService\n\n      // Default value for hiding side filters when no facets are found\n      $scope.hideFacets = true\n\n      // Show siblings if we have no children and are a member of the set of siblings.\n      // Checking for membership prevents some issues with orphan collections.\n\n      function shouldShowSiblings() {\n        const isSibling = _.find(tree.siblings, sibling => {\n          return utilService.stateIs(\n            sibling.state,\n            sibling.params,\n            tree.current.state,\n            tree.current.params\n          )\n        })\n        return isSibling && (!$scope.tree.children || !$scope.tree.children.length)\n      }\n      $scope.showSiblings = shouldShowSiblings()\n\n      // Generate id attributes\n\n      $scope.idAttrs = {}\n\n      const appendCategoryIdToIdAttr = (currentIdAttr, params) =>\n        params && (params.category_id || params.recipe_category_id)\n          ? `${currentIdAttr}-${params.category_id || params.recipe_category_id}`\n          : currentIdAttr\n      const generateIdAttr = treeNode =>\n        appendCategoryIdToIdAttr(`catalog-nav-${treeNode.state.replace('.', '-')}`, treeNode.params)\n\n      if (tree.parents) {\n        $scope.idAttrs.parents = _.map(tree.parents, generateIdAttr)\n      }\n      if ($scope.showSiblings) {\n        $scope.idAttrs.siblings = _.map(tree.siblings, generateIdAttr)\n      }\n      if (tree.children && tree.children.length > 0) {\n        $scope.idAttrs.current = generateIdAttr(tree.current)\n        $scope.idAttrs.children = _.map(tree.children, generateIdAttr)\n      } else if (!$scope.showSiblings) {\n        // If there are no children and no siblings\n        $scope.idAttrs.current = generateIdAttr(tree.current)\n      }\n\n      // Wait for `facetedSearchService.getAllFacets` to successfully return data in `searchController` if facets enabled and user is not viewing a collection\n      if (config.enableFacetedSearchFilters || config.enableICSearch) {\n        facetedSearchService\n          .getAllFacets($stateParams)\n          .then(results => {\n            $scope.sideFacetsArray = facetedSearchService.categorizedFacetsObject?.sideFilters.filter(\n              sideFilter => sideFilter.items.length > 0\n            )\n            $scope.hideFacets =\n              results.hideFacets ||\n              !tagsService.useFacetedFilters() ||\n              $scope.sideFacetsArray.length === 0\n            $rootScope.$broadcast('facetsDataReceived', results)\n          })\n          .catch(() => {\n            $scope.hideFacets = true\n          })\n      }\n\n      // TODO: This is gross. Move DOM handling out of the controller\n      if (mobileService.isMobile && $scope.showSiblings) {\n        $timeout(() => {\n          // Scroll to current highlighted menu item if we're showing siblings in mobile\n          const shopMenuEl = $element[0].querySelector('.js-mobile-shop-menu')\n          if (shopMenuEl) {\n            const currentMenuItemEl = shopMenuEl.querySelector('.current')\n            // eslint-disable-next-line no-restricted-globals\n            const screenWidth = window.innerWidth > 0 ? window.innerWidth : screen.width\n\n            if (currentMenuItemEl) {\n              // Scroll such that current menu item is centered\n              shopMenuEl.scrollLeft =\n                currentMenuItemEl.offsetLeft - (screenWidth - currentMenuItemEl.offsetWidth) / 2\n            }\n          }\n        }, 0)\n      }\n\n      /**\n       * Handler for navigating to URLs in same window or a new one.\n       * Also safely handles root url to go to shop home.\n       * @param {string} url - the URL to navigate to\n       */\n      $scope.navigateToUrl = url => {\n        // eslint-disable-next-line eqeqeq\n        if (url == '/') {\n          // Single forward slashes should go home.\n          $state.go('main.home')\n        } else if (url.match(/^\\//)) {\n          // relative paths use $location\n          $location.path(url)\n        } else if (utilService.isLinkInternal(url)) {\n          utilService.openInternalUrl(url)\n        } else {\n          // external urls require $window\n          $window.open(url, '_self')\n        }\n      }\n\n      $scope.go = function (sref, params, event) {\n        // eslint-disable-next-line no-unused-expressions\n        event?.preventDefault()\n        // eslint-disable-next-line no-unused-expressions\n        event?.stopPropagation()\n        if (!utilService.stateIs(sref, params)) {\n          $element.addClass('going')\n        }\n        $state.go(sref, params)\n      }\n\n      $scope.resetFacets = () => {\n        facetedSearchService.resetTagCrumbs()\n        $state.go('.', { page: null, brand_name: null, tags: null })\n      }\n\n      $scope.shouldShowReset = () => {\n        return facetedSearchService.tagCrumbsArray.length > 0\n      }\n\n      $scope.isNonEComLightChild = treeChild => {\n        return config.eComLight.enabled ? eComLightService?.isNonEComLightCategory(treeChild) : true\n      }\n    }\n  )\n"],"sourceRoot":""}